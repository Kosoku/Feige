# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

import "../Overseer/fastlane/Fastfile"

default_platform(:ios)

platform :ios do
  scheme_name = "Feige"
  module_name = "Feige"
  info_plist_path = "Feige/Info.plist"
  podspec_name = "Feige.podspec"
  xcodeproj_path = "Feige.xcodeproj"
  plist_bundle_short_version_string_key = "CFBundleShortVersionString"

  ENV[scheme_name.upcase] = scheme_name
  ENV[xcodeproj_path.upcase] = xcodeproj_path
  ENV[module_name.upcase] = module_name
  ENV[info_plist_path.upcase] = info_plist_path

  desc "Set short version string"
  lane :set_short_version_string do
    Dir.chdir("..") do
      short_version_string = prompt(text: "Short version string: ")

      sh("./scripts/set_info_plist_key.sh #{plist_bundle_short_version_string_key} #{short_version_string}")
      sh("./scripts/set_podspec_version.sh #{short_version_string}")
      sh("git commit -a -m \"Bump version to #{short_version_string}\"")
    end
  end
end
